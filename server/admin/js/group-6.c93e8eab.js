(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["group-6"],{"0427":function(e,t,r){"use strict";var n=r("b7b3"),a=r.n(n);a.a},"07da":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"about"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("系统管理")]),r("el-breadcrumb-item",[e._v(e._s(e.id?"编辑":"新建")+"权限")])],1),r("el-form",{attrs:{"label-width":"120px"},nativeOn:{submit:function(t){return t.preventDefault(),e.save(t)}}},[r("el-form-item",{attrs:{label:"关联菜单"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.getPower}},[e._v("分配权限")]),r("el-dialog",{attrs:{title:"【写权限在读权限开启后有效,非操作菜单没有写权限】",visible:e.isShow,width:"50%"},on:{"update:visible":function(t){e.isShow=t},close:e.saveMenu}},[r("el-tree",{ref:"tree",attrs:{data:e.menus,"default-checked-keys":e.nodes,"show-checkbox":"","default-expand-all":"","node-key":"name","highlight-current":""},on:{"check-change":e.click},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",[e._v(e._s(a.name))]),3==n.level?r("span",[e._v(" 读权限 "),r("el-switch",{attrs:{"active-color":"#0af","inactive-color":"#bbb"},on:{change:function(t){return e.handleRead(a,n)}},model:{value:a.read,callback:function(t){e.$set(a,"read",t)},expression:"data.read"}}),e._v(" 写权限 "),r("el-switch",{attrs:{"active-color":"#0af","inactive-color":"#bbb"},on:{change:function(t){return e.handleWrite(a,n)}},model:{value:a.write,callback:function(t){e.$set(a,"write",t)},expression:"data.write"}})],1):e._e()])}}])}),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.isShow=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.isShow=!1}}},[e._v("确 定")])],1)],1)],1),r("el-form-item",{attrs:{label:"权限名"}},[r("el-input",{model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary","native-type":"submit"}},[e._v("保存")])],1)],1)],1)},a=[],i=(r("4de4"),r("4160"),r("45fc"),r("a434"),r("b0c0"),r("159b"),r("96cf"),r("1da1")),c={props:{id:{}},data:function(){return{model:{},menus:[],nodes:[],isShow:!1}},methods:{save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.id){t.next=5;break}return t.next=3,e.$http.put("rest/powers/".concat(e.id),e.model);case 3:t.next=7;break;case 5:return t.next=7,e.$http.post("rest/powers",e.model);case 7:e.$router.push("/powers/list"),e.$message.success("保存成功");case 9:case"end":return t.stop()}}),t)})))()},fetch:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/powers/".concat(e.id));case 2:r=t.sent,e.model=r.data;case 4:case"end":return t.stop()}}),t)})))()},merge:function(e,t){if(e.write=e.write||t.write,e.read=e.read||t.read,e.children&&e.children.length)for(var r in t.children)this.merge(e.children[r],t.children[r])},fetchGetMenus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/menus");case 2:if(r=t.sent,e.menus=r.data.filter((function(e){return 1==e.level})),!e.id){t.next=10;break}return t.next=7,e.$http.put("rest/powers/".concat(e.id),e.model);case 7:n=t.sent,e.nodes=n.data.nodes,e.menus.forEach((function(t,r){n.data.children.forEach((function(n){n.name==t.name&&e.menus.splice(r,1,n)}))}));case 10:e.clearLastChild(e.menus);case 11:case"end":return t.stop()}}),t)})))()},clearLastChild:function(e){for(var t=0;t<e.length;t++)e[t].children&&e[t].children.length?this.clearLastChild(e[t].children):delete e[t].children},getPower:function(){this.isShow=!0},collect:function(e,t){var r=this,n=e[t];if(e.children&&e.children.length){for(var a=e.children,i=0;i<a.length;i++){var c=a[i][t];a[i][t]=c||this.collect(a[i],t)}e[t]=a.some((function(e){return r.collect(e,t)}))}return e[t]||n},saveMenu:function(){var e=this;this.model.children=this.menus.filter((function(t){return e.collect(t,"read"),e.collect(t,"write"),t.read})),this.model.nodes=this.$refs.tree.getCheckedKeys()},click:function(e,t,r){t?(e.read=!0,r&&e.children&&e.children.length&&e.children.forEach((function(e){e.read=!0}))):(e.read=!1,this.handleRead(e))},handleRead:function(e,t){void 0!=t&&this.syncNode(e,t),!e.read&&e.write&&(e.write=!1)},handleWrite:function(e,t){void 0!=t&&this.syncNode(e,t),!e.read&&e.write&&(e.write=!1,this.$message.warning("请先开启读权限"))},syncNode:function(e,t){if(e.read){var r=this.$refs.tree.getCheckedKeys();r.length?this.$refs.tree.setChecked(t.key,!0):this.$refs.tree.setCheckedKeys([t.key])}else{var n=this.$refs.tree.getCheckedKeys();n.length?this.$refs.tree.setChecked(t.key,!1):this.$refs.tree.setCheckedKeys([])}}},created:function(){this.id&&this.fetch(),this.fetchGetMenus()}},s=c,o=(r("4633"),r("2877")),l=Object(o["a"])(s,n,a,!1,null,"a4771dc8",null);t["default"]=l.exports},"381a":function(e,t,r){},"45fc":function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").some,i=r("a640"),c=r("ae40"),s=i("some"),o=c("some");n({target:"Array",proto:!0,forced:!s||!o},{some:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},4633:function(e,t,r){"use strict";var n=r("381a"),a=r.n(n);a.a},"4de4":function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").filter,i=r("1dde"),c=r("ae40"),s=i("filter"),o=c("filter");n({target:"Array",proto:!0,forced:!s||!o},{filter:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},b7b3:function(e,t,r){},bf88:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"about"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("系统管理")]),r("el-breadcrumb-item",[e._v("权限列表")])],1),r("el-table",{attrs:{data:e.items,size:"mini",stripe:"",border:""}},[r("el-table-column",{attrs:{prop:"_id",label:"ID",width:"300"}}),r("el-table-column",{attrs:{label:"权限名",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{effect:"dark",type:e.getStyle(t.row.level)}},[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{type:"expand",label:"权限树",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tree",{ref:"tree",attrs:{data:t.row.children,"default-checked-keys":t.row.nodes,"show-checkbox":"","default-expanded-keys":t.row.nodes,"node-key":"name",accordion:"","highlight-current":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",[e._v(e._s(a.name))]),3==n.level?r("span",[e._v(" 读权限 "),r("el-switch",{attrs:{"active-color":"#0af",disabled:"","inactive-color":"#bbb"},on:{change:function(t){return e.handleRead(a,n)}},model:{value:a.read,callback:function(t){e.$set(a,"read",t)},expression:"data.read"}}),e._v(" 写权限 "),r("el-switch",{attrs:{"active-color":"#0af",disabled:"","inactive-color":"#bbb"},on:{change:function(t){return e.handleWrite(a,n)}},model:{value:a.write,callback:function(t){e.$set(a,"write",t)},expression:"data.write"}})],1):e._e()])}}],null,!0)})]}}])}),r("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return null==t.row.read?[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.$router.push("/powers/edit/"+t.row._id)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){return e.remove(t.row)}}},[e._v("删除")])]:void 0}}],null,!0)})],1)],1)},a=[],i=(r("b0c0"),r("96cf"),r("1da1")),c={data:function(){return{items:[],tagType:["","warning","info"]}},methods:{fetch:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/powers");case 2:r=t.sent,e.items=r.data;case 4:case"end":return t.stop()}}),t)})))()},remove:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$confirm('是否确认要删除权限 "'.concat(e.name,'"'),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.delete("rest/powers/".concat(e._id));case 2:t.$message.success("删除成功!"),t.fetch();case 4:case"end":return r.stop()}}),r)}))));case 1:case"end":return r.stop()}}),r)})))()},getStyle:function(e){return e?this.tagType[e-1]:"danger"}},created:function(){this.fetch()}},s=c,o=(r("0427"),r("2877")),l=Object(o["a"])(s,n,a,!1,null,"086aa685",null);t["default"]=l.exports}}]);